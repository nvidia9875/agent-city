# AgentTown 仕様書

## 概要
AgentTown は、災害対応やイベント運営の「予行演習」をブラウザで体験できる 2.5D シミュレーションです。仮想住民は噂・公式情報・周囲の行動を手掛かりに自律的に動き、情報伝播や避難判断の分岐を観察できます。目的は **創発的な集団行動** と **脆弱層の取り残されやすさ** を可視化することです。

## ゴール / 非ゴール
### ゴール
- アイソメ視点の街（OrthographicCamera）を描画
- 道路/草地タイルを InstancedMesh で表示
- 住民（設定に応じた人数）が滑らかに移動し、噂・公式情報・避難行動がタイムラインに流れる
- HTML UI でメトリクス / タイムライン / 介入パネルを表示
- 建物・住民にホバーすると吹き出し、クリックで固定表示（最大1つ）
- WebSocket サーバーで WORLD_INIT / WORLD_DIFF / EVENT / METRICS を配信
- サーバーがシミュレーションを進行し、クライアントは描画に専念

### 非ゴール
- 本番の物理シミュレーションや群衆最適化
- 高精度な 3D モデル / アニメーション

## UI 構成（/sim）
- **TopHud**: 稼働状況、ティック、メトリクス（混乱度 / 噂拡散 / 公式到達 / 要支援到達）
- **LeftTimeline**: 事件ログ（警報 / 公式 / 噂 / 避難 / 支援 / 安否 / 移動 / 会話 / 介入）
- **BottomInterventions**: 介入カード（公式警報一斉配信 / 避難所拡張 / ファクトチェック / 要支援者支援）
- **中央Canvas**: 3D街 + 住民 + クリック/ホバー用ツールチップ
- **起動モーダル**: 初期表示でサイズ/人数/建物/地形を設定し、Start で開始

## エージェント設計
- 基本属性: 年齢層、移動制約、言語、聴覚、世帯、役割
- 脆弱性タグ: 高齢者 / 子ども / 要介助 / 非日本語話者 など
- 状態: 気分、ストレス、エネルギー、警報認知（噂/公式/未達）、避難状態

## 3D表現
- OrthographicCamera のアイソメ視点
- 建物は箱の組み合わせで可愛く表現
- 住民は Sprite で表示、tick ごとに lerp 移動
- 地形は草地/海/山/公園タイルで色分け

## シナリオ例
- 沿岸の町、夕刻。地震発生。公式警報は15分遅延。
- 噂が先行し、地区ごとに避難判断が分岐。

## 操作
- 住民 / 建物にホバーで吹き出し表示
- クリックで吹き出し固定、別の対象をクリックで上書き
- 空白クリックで吹き出し解除

## AI 連携（将来/実装中）
- Vertex AI で住民の意思決定理由を生成
- Cloud SQL（MySQL）に reasoning を保存
- Terraform / scripts で GCP リソースとシードを準備
- 記憶生成 → Embedding → Vector Search upsert のパイプラインを用意
- サーバー側で AI が行動決定するモードを用意（SIM_AI_DECISION_ENABLED）
- ADK（Agent Development Kit）経由の行動決定を用意（SIM_ADK_ENABLED）
